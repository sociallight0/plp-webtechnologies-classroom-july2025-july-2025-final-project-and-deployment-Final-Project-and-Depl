<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register - MindSpace</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/auth.css">
</head>
<body>
  <div class="auth-container">
    <div class="auth-box">
      <div class="auth-header">
        <div class="logo">
          <h1>ðŸ§  MindSpace</h1>
        </div>
        <h2>Create Account</h2>
        <p class="text-muted">Start your mental wellness journey today</p>
      </div>

      <form id="registerForm" class="auth-form">
        <div class="form-group">
          <label for="fullName">Full Name</label>
          <input 
            type="text" 
            id="fullName" 
            name="fullName" 
            placeholder="Enter your full name"
            required
          >
          <div id="fullNameError" class="error-message"></div>
        </div>

        <div class="form-group">
          <label for="email">Email Address</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            placeholder="Enter your email"
            required
          >
          <div id="emailError" class="error-message"></div>
        </div>

        <div class="form-group">
          <label for="username">Username</label>
          <input 
            type="text" 
            id="username" 
            name="username" 
            placeholder="Choose a username"
            required
          >
          <div id="usernameError" class="error-message"></div>
        </div>

        <div class="form-group">
          <label for="phone">Phone Number</label>
          <input 
            type="tel" 
            id="phone" 
            name="phone" 
            placeholder="+1 (555) 123-4567"
            required
          >
          <div id="phoneError" class="error-message"></div>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input 
            type="password" 
            id="password" 
            name="password" 
            placeholder="Create a password (min. 6 characters)"
            required
          >
          <div class="password-strength">
            <div id="strengthBar" class="strength-bar"></div>
          </div>
          <div id="passwordError" class="error-message"></div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <input 
            type="password" 
            id="confirmPassword" 
            name="confirmPassword" 
            placeholder="Re-enter your password"
            required
          >
          <div id="confirmPasswordError" class="error-message"></div>
        </div>

        <div class="form-group">
          <label for="emergencyName">Emergency Contact Name</label>
          <input 
            type="text" 
            id="emergencyName" 
            name="emergencyName" 
            placeholder="Emergency contact name"
          >
        </div>

        <div class="form-group">
          <label for="emergencyPhone">Emergency Contact Phone</label>
          <input 
            type="tel" 
            id="emergencyPhone" 
            name="emergencyPhone" 
            placeholder="+1 (555) 000-0000"
          >
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="terms" required>
            <span>I agree to the <a href="#" target="_blank">Terms of Service</a> and <a href="#" target="_blank">Privacy Policy</a></span>
          </label>
          <div id="termsError" class="error-message"></div>
        </div>

        <div id="formError" class="error-message"></div>

        <button type="submit" class="btn btn-primary btn-block btn-lg">
          Create Account
        </button>
      </form>

      <div class="auth-footer">
        <p>Already have an account? <a href="login.html">Login here</a></p>
      </div>
    </div>

    <div class="auth-image">
      <div class="image-overlay">
        <h2>Join Our Community</h2>
        <p>Thousands of people have started their mental health journey with MindSpace</p>
        <div class="stats-grid">
          <div class="stat-item">
            <h3>500+</h3>
            <p>Licensed Therapists</p>
          </div>
          <div class="stat-item">
            <h3>10K+</h3>
            <p>Active Users</p>
          </div>
          <div class="stat-item">
            <h3>50K+</h3>
            <p>Sessions Completed</p>
          </div>
          <div class="stat-item">
            <h3>4.9â˜…</h3>
            <p>Average Rating</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="js/db.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script>
    // Initialize registration functionality
    document.addEventListener('DOMContentLoaded', async () => {
      // Check if already logged in
      const isLoggedIn = await AuthUtils.isLoggedIn();
      if (isLoggedIn) {
        window.location.href = 'dashboard.html';
        return;
      }

      const registerForm = document.getElementById('registerForm');
      const passwordInput = document.getElementById('password');
      const strengthBar = document.getElementById('strengthBar');

      // Password strength indicator
      passwordInput.addEventListener('input', () => {
        const password = passwordInput.value;
        let strength = 0;

        if (password.length >= 6) strength += 25;
        if (password.length >= 10) strength += 25;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 25;
        if (/\d/.test(password)) strength += 25;

        strengthBar.style.width = strength + '%';
        
        if (strength <= 25) {
          strengthBar.style.backgroundColor = '#DC3545';
        } else if (strength <= 50) {
          strengthBar.style.backgroundColor = '#FFC107';
        } else if (strength <= 75) {
          strengthBar.style.backgroundColor = '#52B788';
        } else {
          strengthBar.style.backgroundColor = '#2D6A4F';
        }
      });

      // Handle registration form submission
      registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Get form values
        const fullName = document.getElementById('fullName').value.trim();
        const email = document.getElementById('email').value.trim();
        const username = document.getElementById('username').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const emergencyName = document.getElementById('emergencyName').value.trim();
        const emergencyPhone = document.getElementById('emergencyPhone').value.trim();
        const terms = document.getElementById('terms').checked;

        // Clear previous errors
        ['fullName', 'email', 'username', 'phone', 'password', 'confirmPassword', 'terms', 'form'].forEach(id => {
          UIUtils.clearError(id + 'Error');
        });

        // Validation
        let hasError = false;

        if (!ValidationUtils.isNotEmpty(fullName)) {
          UIUtils.showError('fullNameError', 'Full name is required');
          hasError = true;
        }

        if (!ValidationUtils.isValidEmail(email)) {
          UIUtils.showError('emailError', 'Please enter a valid email address');
          hasError = true;
        }

        if (!ValidationUtils.isNotEmpty(username) || username.length < 3) {
          UIUtils.showError('usernameError', 'Username must be at least 3 characters');
          hasError = true;
        }

        if (!ValidationUtils.isValidPhone(phone)) {
          UIUtils.showError('phoneError', 'Please enter a valid phone number');
          hasError = true;
        }

        if (!ValidationUtils.isValidPassword(password)) {
          UIUtils.showError('passwordError', 'Password must be at least 6 characters and contain a number');
          hasError = true;
        }

        if (password !== confirmPassword) {
          UIUtils.showError('confirmPasswordError', 'Passwords do not match');
          hasError = true;
        }

        if (!terms) {
          UIUtils.showError('termsError', 'You must agree to the terms and conditions');
          hasError = true;
        }

        if (hasError) return;

        // Attempt registration
        try {
          const userData = {
            fullName,
            email,
            username,
            phone,
            password,
            emergencyContact: {
              name: emergencyName || '',
              phone: emergencyPhone || ''
            }
          };

          const result = await Auth.register(userData);
          
          if (result.success) {
            UIUtils.showNotification('Account created successfully! Redirecting to login...', 'success');
            setTimeout(() => {
              window.location.href = 'login.html';
            }, 1500);
          } else {
            UIUtils.showError('formError', result.message || 'Registration failed. Please try again.');
          }
        } catch (error) {
          console.error('Registration error:', error);
          UIUtils.showError('formError', 'An error occurred. Please try again.');
        }
      });
    });
  </script>
</body>
</html>
